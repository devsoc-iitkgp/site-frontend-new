import{G as S}from"./index-j7DW7U0N.js";const x=new Uint8Array(4);function y(u){return(u&u-1)===0}let M=1;class L{constructor(i,{image:a,target:t=i.TEXTURE_2D,type:r=i.UNSIGNED_BYTE,format:E=i.RGBA,internalFormat:o=E,wrapS:p=i.CLAMP_TO_EDGE,wrapT:s=i.CLAMP_TO_EDGE,wrapR:l=i.CLAMP_TO_EDGE,generateMipmaps:g=t===(i.TEXTURE_2D||i.TEXTURE_CUBE_MAP),minFilter:T=g?i.NEAREST_MIPMAP_LINEAR:i.LINEAR,magFilter:_=i.LINEAR,premultiplyAlpha:A=!1,unpackAlignment:f=4,flipY:e=t==(i.TEXTURE_2D||i.TEXTURE_3D),anisotropy:n=0,level:R=0,width:U,height:d=U,length:h=1}={}){this.gl=i,this.id=M++,this.image=a,this.target=t,this.type=r,this.format=E,this.internalFormat=o,this.minFilter=T,this.magFilter=_,this.wrapS=p,this.wrapT=s,this.wrapR=l,this.generateMipmaps=g,this.premultiplyAlpha=A,this.unpackAlignment=f,this.flipY=e,this.anisotropy=Math.min(n,this.gl.renderer.parameters.maxAnisotropy),this.level=R,this.width=U,this.height=d,this.length=h,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(i=0){const a=!(this.image===this.store.image&&!this.needsUpdate);if((a||this.glState.textureUnits[i]!==this.id)&&(this.gl.renderer.activeTexture(i),this.bind()),!!a){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.wrapR!==this.state.wrapR&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_R,this.wrapR),this.state.wrapR=this.wrapR),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.target===this.gl.TEXTURE_2D?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):(this.target===this.gl.TEXTURE_2D_ARRAY||this.target===this.gl.TEXTURE_3D)&&this.gl.texImage3D(this.target,this.level,this.internalFormat,this.width,this.height,this.length,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.target===this.gl.TEXTURE_2D?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image):this.gl.texImage3D(this.target,this.level,this.internalFormat,this.width,this.height,this.length,0,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!y(this.image.width)||!y(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,x);else this.width?this.target===this.gl.TEXTURE_2D?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage3D(this.target,this.level,this.internalFormat,this.width,this.height,this.length,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,x);this.store.image=this.image}}}class I extends S{constructor(i,{width:a=1,height:t=1,widthSegments:r=1,heightSegments:E=1,attributes:o={}}={}){const p=r,s=E,l=(p+1)*(s+1),g=p*s*6,T=new Float32Array(l*3),_=new Float32Array(l*3),A=new Float32Array(l*2),f=g>65536?new Uint32Array(g):new Uint16Array(g);I.buildPlane(T,_,A,f,a,t,0,p,s),Object.assign(o,{position:{size:3,data:T},normal:{size:3,data:_},uv:{size:2,data:A},index:{data:f}}),super(i,o)}static buildPlane(i,a,t,r,E,o,p,s,l,g=0,T=1,_=2,A=1,f=-1,e=0,n=0){const R=e,U=E/s,d=o/l;for(let h=0;h<=l;h++){let w=h*d-o/2;for(let m=0;m<=s;m++,e++){let F=m*U-E/2;if(i[e*3+g]=F*A,i[e*3+T]=w*f,i[e*3+_]=p/2,a[e*3+g]=0,a[e*3+T]=0,a[e*3+_]=p>=0?1:-1,t[e*2]=m/s,t[e*2+1]=1-h/l,h===l||m===s)continue;let D=R+m+h*(s+1),P=R+m+(h+1)*(s+1),X=R+m+(h+1)*(s+1)+1,c=R+m+h*(s+1)+1;r[n*6]=D,r[n*6+1]=P,r[n*6+2]=c,r[n*6+3]=P,r[n*6+4]=X,r[n*6+5]=c,n++}}}}export{I as P,L as T};
